{% extends 'seeker_base.html' %}
{% block content %}

<!-- Include jQuery and Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-0 py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="h4 text-primary mb-0">Edit Job Posting</h2>
                        <a href="{% url 'myjob' %}" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-arrow-left me-1"></i> Back to Jobs
                        </a>
                    </div>
                </div>
                
                <div class="card-body">
                    <form method="POST" action="{% url 'edit_job' job.id %}">
                        {% csrf_token %}
                        
                        <!-- Title -->
                        <div class="mb-4">
                            <label for="title" class="form-label">Job Title</label>
                            <input type="text" class="form-control" id="title" name="title" 
                                   value="{{ job.title }}" required>
                        </div>
                        
                        <!-- Description -->
                        <div class="mb-4">
                            <label for="description" class="form-label">Job Description</label>
                            <textarea class="form-control" id="description" name="description" 
                                      rows="5" required>{{ job.description }}</textarea>
                        </div>
                        
                        <div class="row">
                            <!-- Category -->
                            <div class="col-md-6 mb-4">
                                <label for="category" class="form-label">Category</label>
                                <select class="form-select" id="category" name="category" required>
                                    {% for cat in job_cat %}
                                    <option value="{{ cat.id }}" {% if cat.id == job.category.id %}selected{% endif %}>
                                        {{ cat.name }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Required Skills -->
                            <div class="col-md-6 mb-4">
                                <label for="required_skills" class="form-label">Required Skills</label>
                                <select class="form-select" id="required_skills" name="required_skills" multiple="multiple">
                                    {% for skill in all_skills %}
                                        <option value="{{ skill.id }}"
                                            {% if skill in job.required_skills.all %}selected{% endif %}>
                                            {{ skill.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- Location -->
                            <div class="col-md-6 mb-4">
                                <label for="location" class="form-label">Location</label>
                                <select class="form-select" id="location" name="location" required>
                                    <option value="">Select City</option>
                                    {% for city in ethiopian_cities %}
                                        <option value="{{ city }}" {% if city == job.location %}selected{% endif %}>{{ city }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Job Type -->
                            <div class="col-md-6 mb-4">
                                <label for="job_type" class="form-label">Job Type</label>
                                <select class="form-select" id="job_type" name="job_type" required>
                                    <option value="Full-time" {% if job.job_type == 'Full-time' %}selected{% endif %}>Full-time</option>
                                    <option value="Part-time" {% if job.job_type == 'Part-time' %}selected{% endif %}>Part-time</option>
                                    <option value="Contract" {% if job.job_type == 'Contract' %}selected{% endif %}>Contract</option>
                                    <option value="Internship" {% if job.job_type == 'Internship' %}selected{% endif %}>Internship</option>
                                    <option value="Temporary" {% if job.job_type == 'Temporary' %}selected{% endif %}>Temporary</option>
                                    <option value="Remote" {% if job.job_type == 'Remote' %}selected{% endif %}>Remote</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Salary Range -->
                        <div class="mb-4">
                            <label for="salary_range" class="form-label">Salary Range</label>
                            <input type="text" class="form-control" id="salary_range" name="salary_range" 
                                   value="{{ job.salary_range }}" required>
                            <div class="form-text">Example: $50,000 - $70,000 per year</div>
                        </div>

                        <!-- Deadline -->
                        <div class="mb-4">
                            <label for="deadline" class="form-label">Application Deadline</label>
                            <input type="date" class="form-control" id="deadline" name="deadline" 
                                   value="{{ job.deadline|date:'Y-m-d' }}" required>
                        </div>
                        
                        <!-- Active checkbox -->
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" value="true" id="is_active" name="is_active"
                                   {% if job.is_active %}checked{% endif %}>
                            <label class="form-check-label" for="is_active">
                                Active
                            </label>
                            <div class="form-text">Uncheck to make this job inactive immediately.</div>
                        </div>
                        
                        <!-- Form Buttons -->
                        <div class="d-flex justify-content-between mt-5">
                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" 
                                    data-bs-target="#deleteModal">
                                <i class="fas fa-trash-alt me-2"></i>Delete Job
                            </button>
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="fas fa-save me-2"></i>Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this job posting? This action cannot be undone.</p>
                <p class="fw-bold">Job Title: {{ job.title }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form method="POST" action="{% url 'delete_job' job.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Delete Permanently</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Initialize Select2 -->
<script>
$(document).ready(function() {
    $('#required_skills').select2({
        placeholder: "Select required skills",
        allowClear: true,
        width: '100%'
    });
});
</script>

{% endblock %}
